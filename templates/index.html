{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="alert-container mb-3">
            <!-- Container for dynamically added alerts via JavaScript -->
        </div>
        
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <h2 class="card-title text-center mb-0">
                    <i class="fas fa-robot me-2"></i>WiduxBot
                </h2>
            </div>
            <div class="card-body">
                <div class="text-center mb-4">
                    <p class="lead">بوت تويتش فعال لإدارة لعبة "وج؟" في قناتك</p>
                </div>
                
                <div class="alert alert-info mb-4">
                    <h4 class="alert-heading"><i class="fas fa-info-circle me-2"></i>ملاحظة مهمة</h4>
                    <p>لتشغيل البوت، تحتاج إلى توفير بيانات اعتماد Twitch التالية كمتغيرات بيئية:</p>
                    <ul>
                        <li><strong>TWITCH_TMI_TOKEN</strong>: رمز الوصول للبوت (يبدأ بـ oauth:)</li>
                        <li><strong>TWITCH_CLIENT_ID</strong>: معرف التطبيق المسجل في Twitch</li>
                        <li><strong>TWITCH_BOT_USERNAME</strong>: اسم مستخدم البوت على Twitch</li>
                    </ul>
                    <p class="mb-0">بدون هذه المعلومات، لن يتمكن البوت من الاتصال بـ Twitch.</p>
                </div>
                
                <h3 class="mb-3">تسجيل قناة جديدة</h3>
                <form action="{{ url_for('register_channel') }}" method="post" class="mb-4">
                    <div class="input-group mb-3">
                        <input type="text" name="channel_name" class="form-control" placeholder="أدخل اسم قناة تويتش" required>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus-circle me-1"></i> تفعيل البوت
                        </button>
                    </div>
                </form>
                
                <h3 class="mb-3">القنوات النشطة</h3>
                {% if channels %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>اسم القناة</th>
                                    <th>الحالة</th>
                                    <th>تاريخ التسجيل</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for channel in channels %}
                                <tr id="channel-{{ channel.id }}">
                                    <td>{{ channel.name }}</td>
                                    <td>
                                        {% if channel.is_active %}
                                            <span class="badge bg-success channel-status">نشط</span>
                                        {% else %}
                                            <span class="badge bg-secondary channel-status">متوقف</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ channel.created_at.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        <form action="{{ url_for('toggle_channel', channel_id=channel.id) }}" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-sm toggle-channel-btn {% if channel.is_active %}btn-danger{% else %}btn-success{% endif %}" data-channel-id="{{ channel.id }}">
                                                <span class="spinner-border spinner-border-sm d-none" role="status"></span>
                                                <span class="btn-text">
                                                {% if channel.is_active %}
                                                    <i class="fas fa-pause me-1"></i> إيقاف
                                                {% else %}
                                                    <i class="fas fa-play me-1"></i> تشغيل
                                                {% endif %}
                                                </span>
                                            </button>
                                        </form>
                                        <form action="{{ url_for('delete_channel', channel_id=channel.id) }}" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('هل أنت متأكد من حذف هذه القناة؟')">
                                                <i class="fas fa-trash me-1"></i> حذف
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        لا توجد قنوات مسجلة بعد. قم بإضافة قناة جديدة باستخدام النموذج أعلاه.
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h3 class="card-title mb-0">تعليمات استخدام البوت</h3>
            </div>
            <div class="card-body">
                <h4 class="mt-3">طريقة اللعب:</h4>
                <ol class="list-group list-group-numbered mb-4">
                    <li class="list-group-item">اكتب "وج؟" في الدردشة لبدء اللعبة</li>
                    <li class="list-group-item">اختر نمط اللعب: "فردي"، "تحدي" (جماعي)، أو "تيم" (فرق)</li>
                    <li class="list-group-item">اتبع تعليمات البوت للتسجيل واختيار قادة الفرق</li>
                    <li class="list-group-item">أجب عن الأسئلة بسرعة للحصول على أكبر عدد من النقاط</li>
                </ol>
                
                <h4>أنماط اللعب:</h4>
                <div class="accordion mb-4" id="gameModesAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingOne">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                فردي
                            </button>
                        </h2>
                        <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#gameModesAccordion">
                            <div class="accordion-body">
                                <p>لعب فردي ضد البوت. يجيب اللاعب على الأسئلة ويحصل على نقاط.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTwo">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                تحدي (جماعي)
                            </button>
                        </h2>
                        <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#gameModesAccordion">
                            <div class="accordion-body">
                                <p>لعب جماعي حيث يتسجل كل لاعب بمفرده. يتنافس اللاعبون على الإجابة بسرعة.</p>
                                <p>للتسجيل، يكتب المشاهد "R" عند الطلب.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingThree">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                تيم (فرق)
                            </button>
                        </h2>
                        <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#gameModesAccordion">
                            <div class="accordion-body">
                                <p>فريقان يتنافسان، فريق أحمر وفريق أزرق. للتسجيل في الفريق الأحمر، يكتب المشاهد "أحمر"، وللفريق الأزرق يكتب "أزرق".</p>
                                <p>يختار كل فريق قائداً له خلال 20 ثانية.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h4>أنواع الأسئلة الخاصة:</h4>
                <ul class="list-group mb-4">
                    <li class="list-group-item list-group-item-warning">
                        <strong>السؤال الذهبي:</strong> إجابة صحيحة تمنح 50 نقطة!
                    </li>
                    <li class="list-group-item list-group-item-danger">
                        <strong>سؤال دووم:</strong> الإجابة الصحيحة تضاعف النقاط، والخاطئة تُفقد الفريق جميع نقاطه!
                    </li>
                    <li class="list-group-item list-group-item-primary">
                        <strong>سؤال زرف:</strong> الفريق الفائز يمكنه سرقة نقاط من الفريق المنافس
                    </li>
                    <li class="list-group-item list-group-item-info">
                        <strong>اختبار المصير:</strong> 5 أسئلة متتابعة، كل إجابة صحيحة تمنح 10 نقاط، وكل خاطئة تخصم 5 نقاط
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
